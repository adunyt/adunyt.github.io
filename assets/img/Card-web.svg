<svg width="100%" height="100%" version="1.1" viewBox="0 0 720 1400" xmlns="http://www.w3.org/2000/svg">
    <defs>
        <marker id="Dot" style="overflow:visible" markerHeight="10" markerUnits="userSpaceOnUse" markerWidth="10"
            orient="auto" preserveAspectRatio="xMidYMid" viewBox="0 0 1 1">
            <path transform="scale(.5)" d="m5 0c0 2.76-2.24 5-5 5s-5-2.24-5-5 2.3-5 5-5c2.76 0 5 2.24 5 5z"
                style="fill-rule:evenodd;fill:context-stroke" />
        </marker>
        <ref type="STRING" label="Название шины данных" source="svgcard-ref-object-link" id="svgcard-ref-object-link" initialValue="DSE_862430056719640" />
        <ref type="STRING" label="Имя" source="svgcard-ref-name" id="svgcard-ref-name" initialValue="DefaultName" />
        <ref type="STRING" label="Номер" source="svgcard-ref-number" id="svgcard-ref-number"
            initialValue="1111111111111" />
        <ref type="STRING" label="Дата/время" source="svgcard-ref-dateTime" id="svgcard-ref-dateTime"
            initialValue="LastTimeUpdate" />
        <ref type="STRING" label="Текущее значение шкалы" source="svgcard-ref-current-meter"
            id="svgcard-ref-current-meter" initialValue="DGU_Param2801" />
        <ref type="STRING" label="Минимальное значение шкалы" source="svgcard-ref-min-meter" id="svgcard-ref-min-meter"
            initialValue="0" />
        <ref type="STRING" label="Максимальное значение шкалы" source="svgcard-ref-max-meter" id="svgcard-ref-max-meter"
            initialValue="100" />
        <ref type="STRING" label="Значение поля 1" source="svgcard-ref-field1" id="svgcard-ref-field1"
            initialValue="DGU_Param2800" />
        <!-- <ref type="COLOR" label="Цвет поля 1" source="svgcard-ref-field1-color" id="svgcard-ref-field1-color"
            initialValue="#90EE90" /> -->
        <ref type="STRING" label="Значение поля 2" source="svgcard-ref-field2" id="svgcard-ref-field2"
            initialValue="DGU_Param2801" />
        <ref type="STRING" label="Значение поля 3" source="svgcard-ref-field3" id="svgcard-ref-field3"
            initialValue="DGU_Param2804" />
        <ref type="STRING" label="Значение поля 4" source="svgcard-ref-field4" id="svgcard-ref-field4"
            initialValue="DGU_Param2866" />
        <ref type="STRING" label="Значение поля 5" source="svgcard-ref-field5" id="svgcard-ref-field5"
            initialValue="DGU_Param2880" />
        <!-- <ref type="COLOR" label="Цвет поля 5" source="svgcard-ref-field5-color" id="svgcard-ref-field5-color"
            initialValue="#90EE90" />
        <ref type="STRING" label="Значение (Столбец 1, Строка 1)" source="col1-value1" id="col1-value1"
            initialValue="L1-N, B" />
        <ref type="STRING" label="Значение (Столбец 1, Строка 2)" source="col1-value2" id="col1-value2"
            initialValue="L1-N, B" />
        <ref type="STRING" label="Значение (Столбец 1, Строка 3)" source="col1-value3" id="col1-value3"
            initialValue="L1-N, B" />
        <ref type="STRING" label="Значение (Столбец 2, Строка 1)" source="col2-value1" id="col2-value1"
            initialValue="223" />
        <ref type="STRING" label="Значение (Столбец 2, Строка 2)" source="col2-value2" id="col2-value2"
            initialValue="241" />
        <ref type="STRING" label="Значение (Столбец 2, Строка 3)" source="col2-value3" id="col2-value3"
            initialValue="243" />
        <ref type="STRING" label="Значение (Столбец 3, Строка 1)" source="col3-value1" id="col3-value1"
            initialValue="0" />
        <ref type="STRING" label="Значение (Столбец 3, Строка 2)" source="col3-value2" id="col3-value2"
            initialValue="0" />
        <ref type="STRING" label="Значение (Столбец 3, Строка 3)" source="col3-value3" id="col3-value3"
            initialValue="0" /> -->
    </defs>

    <text id="meter-percent-text" style="display:none" data-text-content="url(#svgcard-ref-meterPercent)"></text>
    <text id="svg-card-object-link-text" style="display:none" data-text-content="url(#svgcard-ref-object-link)"></text>
    <text id="svg-card-ref-min-meter-text" style="display:none" data-text-content="url(#svgcard-ref-min-meter)"></text>
    <text id="svg-card-ref-max-meter-text" style="display:none" data-text-content="url(#svgcard-ref-max-meter)"></text>

    <g>
        <g>
            <text
                style="fill:#ffffff;font-family:Arial;font-size:48px;shape-inside:url(#rect5);stroke-linecap:round;stroke-miterlimit:0;stroke-width:1.8">
                <tspan x="50" y="93.236212">
                    <tspan style="fill:#000000" data-text-content="url(#svgcard-ref-name)">Name</tspan>
                </tspan>
            </text>
            <text
                style="fill:#ffffff;font-family:Arial;font-size:40px;shape-inside:url(#rect7);stroke-linecap:round;stroke-miterlimit:0;stroke-width:1.8">
                <tspan x="50" y="161.03018">
                    <tspan style="fill:#000000" data-text-content="url(#svgcard-ref-number)">Number
                    </tspan>
                </tspan>
            </text>
            <text transform="translate(0 4.9571)"
                style="fill:#ffffff;font-family:Arial;font-size:32px;shape-inside:url(#rect8);stroke-linecap:round;stroke-miterlimit:0;stroke-width:1.8">
                <tspan x="50" y="253.82414">
                    <tspan style="fill:#000000">Данные на:</tspan>
                </tspan>
            </text>
            <g>
                <rect id="svgcard-datetime-rect" x="250" y="225" width="400" height="50" ry="25"
                    style="fill:#999999;stroke-linecap:round;stroke-miterlimit:0;stroke-width:1.9243" />
                <text
                    style="fill:#ffffff;font-family:Arial;font-size:36px;shape-inside:url(#svgcard-datetime-rect);stroke-linecap:round;stroke-miterlimit:0;stroke-width:1.8;text-align:center-wrap">
                    <tspan x="450" y="252.5" dominant-baseline="middle" text-anchor="middle" data-text-content="url(#svgcard-ref-dateTime)">dataTime</tspan>
                </text>
            </g>
        </g>
        <g transform="translate(0,-20)">
            <path d="M 125,587.5 A 237.5,237.5 0 0 1 362.5,350 237.5,237.5 0 0 1 600,587.5"
                style="fill:none;stroke-linecap:square;stroke-miterlimit:0;stroke-width:20;stroke:#ff2a2a" />
            <path d="m243.75 381.82a237.5 237.5 0 0 1 237.5 0"
                style="fill:none;stroke-linecap:square;stroke-miterlimit:0;stroke-width:20;stroke:#00ff00" />
            <path id="svg-arc-arrow" d="m362.5 595v-237.5"
                style="fill:none;marker-start:url(#Dot);stroke-linecap:round;stroke-miterlimit:0;stroke-width:20;stroke:#ff7f2a" />
            <text
                style="fill:#000000;font-family:Arial;font-size:28px;shape-inside:url(#rect16);stroke-linecap:round;stroke-miterlimit:0;stroke-width:20;text-align:center">
                <tspan x="127.21387" y="625.22112" dominant-baseline="middle" text-anchor="middle"
                    data-text-content="url(#svgcard-ref-min-meter)">0</tspan>
            </text>
            <text
                style="fill:#000000;font-family:Arial;font-size:28px;shape-inside:url(#rect17);stroke-linecap:round;stroke-miterlimit:0;stroke-width:20;text-align:center">
                <tspan x="602.21387" y="625.22112" dominant-baseline="middle" text-anchor="middle"
                    data-text-content="url(#svgcard-ref-max-meter)">1</tspan>
            </text>
        </g>
        <g>
            <g>
                <text x="41.125"
                    style="direction:rtl;fill:#000000;font-family:Arial;font-size:40px;shape-inside:url(#rect20);stroke-linecap:round;stroke-miterlimit:0;stroke-width:20;text-align:end">
                    <tspan x="365.9375" y="686.03018">Режим</tspan>
                </text>
                <text
                    style="direction:rtl;fill:#000000;font-family:Arial;font-size:40px;shape-inside:url(#rect21);stroke-linecap:round;stroke-miterlimit:0;stroke-width:20;text-align:end">
                    <tspan x="365.9375" y="761.03018">Об/мин</tspan>
                </text>
                <text
                    style="direction:rtl;fill:#000000;font-family:Arial;font-size:40px;shape-inside:url(#rect22);stroke-linecap:round;stroke-miterlimit:0;stroke-width:20;text-align:end">
                    <tspan x="365.9375" y="836.03018">Т охл., С</tspan>
                </text>
                <text
                    style="direction:rtl;fill:#000000;font-family:Arial;font-size:40px;shape-inside:url(#rect23);stroke-linecap:round;stroke-miterlimit:0;stroke-width:20;text-align:end">
                    <tspan x="365.9375" y="911.03018">Мощность, кВт</tspan>
                </text>
                <text
                    style="direction:rtl;fill:#000000;font-family:Arial;font-size:40px;shape-inside:url(#rect24);stroke-linecap:round;stroke-miterlimit:0;stroke-width:20;text-align:end">
                    <tspan x="365.9375" y="986.03018">Тревога</tspan>
                </text>
            </g>
            <g>
                <g>
                    <rect x="400" y="650" width="250" height="50" ry="25" data-fill="url(#svgcard-ref-field1-color)"
                        style="stroke-linecap:round;stroke-miterlimit:0;stroke-width:1.9243" />
                    <text
                        style="fill:#FFFFFF;font-family:Arial;font-size:40px;shape-inside:url(#svgcard-value1-rect);stroke-linecap:round;stroke-miterlimit:0;stroke-width:20;text-align:center">
                        <tspan x="525" y="678.5" dominant-baseline="middle" text-anchor="middle" data-text-content="url(#svgcard-ref-field1)">Значение 1</tspan>
                    </text>
                </g>
                <text
                    style="fill:#000000;font-family:Arial;font-size:40px;shape-inside:url(#rect26);stroke-linecap:round;stroke-miterlimit:0;stroke-width:20;text-align:center">
                    <tspan x="419.62891" y="761.03018" data-text-content="url(#svgcard-ref-field2)">Значение 2</tspan>
                </text>
                <text
                    style="fill:#000000;font-family:Arial;font-size:40px;shape-inside:url(#rect27);stroke-linecap:round;stroke-miterlimit:0;stroke-width:20;text-align:center">
                    <tspan x="419.62891" y="836.03018" data-text-content="url(#svgcard-ref-field3)">Значение 3</tspan>
                </text>
                <text
                    style="fill:#000000;font-family:Arial;font-size:40px;shape-inside:url(#rect28);stroke-linecap:round;stroke-miterlimit:0;stroke-width:20;text-align:center">
                    <tspan x="419.62891" y="911.03018" data-text-content="url(#svgcard-ref-field4)">Значение 4</tspan>
                </text>
                <g>
                    <rect x="400" y="950" width="250" height="50" ry="25" data-fill="url(#svgcard-ref-field5-color)"
                        style="fill:stroke-linecap:round;stroke-miterlimit:0;stroke-width:1.9243" />
                    <text
                        style="fill:#FFFFFF;font-family:Arial;font-size:40px;shape-inside:url(#svgcard-value1-rect);stroke-linecap:round;stroke-miterlimit:0;stroke-width:20;text-align:center">
                        <tspan x="525" y="978.5" dominant-baseline="middle" text-anchor="middle" data-text-content="url(#svgcard-ref-field5)">Значение 5</tspan>
                    </text>
                </g>
            </g>
        </g>
        <g>
            <rect x="50" y="1050" width="625" height="50" style="fill:#646464" />
            <rect x="50" y="1100" width="625" height="150" style="fill:#a0a0a0" />
            <rect x="250" y="1100" width="225" height="150" style="fill:#bababa" />
            <text
                style="fill:#ffffff;font-family:Arial;font-size:40px;shape-inside:url(#rect14);stroke-linecap:round;stroke-miterlimit:0;stroke-width:20;text-align:center">/
                <tspan x="149.81055" y="1077.0302" dominant-baseline="middle" text-anchor="middle">Напр-е</tspan>
            </text>
            <text
                style="fill:#ffffff;font-family:Arial;font-size:40px;shape-inside:url(#rect18);stroke-linecap:round;stroke-miterlimit:0;stroke-width:20;text-align:center">
                <tspan x="362.31055" y="1077.0302" dominant-baseline="middle" text-anchor="middle">Ген-р</tspan>
            </text>
            <text
                style="fill:#ffffff;font-family:Arial;font-size:40px;shape-inside:url(#rect30);stroke-linecap:round;stroke-miterlimit:0;stroke-width:20;text-align:center">
                <tspan x="574.81055" y="1077.0302" dominant-baseline="middle" text-anchor="middle">Сеть</tspan>
            </text>
            <g>
                <text
                    style="fill:#ffffff;font-family:Arial;font-size:40px;shape-inside:url(#rect34);stroke-linecap:round;stroke-miterlimit:0;stroke-width:20;text-align:center">
                    <tspan x="148.87695" y="1129.0302" dominant-baseline="middle" text-anchor="middle"
                        data-text-content="url(#col1-value1)">1</tspan>
                </text>
                <text
                    style="fill:#ffffff;font-family:Arial;font-size:40px;shape-inside:url(#rect35);stroke-linecap:round;stroke-miterlimit:0;stroke-width:20;text-align:center">
                    <tspan x="148.87695" y="1179.0302" dominant-baseline="middle" text-anchor="middle"
                        data-text-content="url(#col1-value2)">2</tspan>
                </text>
                <text
                    style="fill:#ffffff;font-family:Arial;font-size:40px;shape-inside:url(#rect36);stroke-linecap:round;stroke-miterlimit:0;stroke-width:20;text-align:center">
                    <tspan x="148.87695" y="1229.0302" dominant-baseline="middle" text-anchor="middle"
                        data-text-content="url(#col1-value3)">3</tspan>
                </text>
            </g>
            <g>
                <text
                    style="fill:#ffffff;font-family:Arial;font-size:40px;shape-inside:url(#rect37);stroke-linecap:round;stroke-miterlimit:0;stroke-width:20;text-align:center">
                    <tspan x="361.37695" y="1129.0302" dominant-baseline="middle" text-anchor="middle"
                        data-text-content="url(#col2-value1)">1</tspan>
                </text>
                <text
                    style="fill:#ffffff;font-family:Arial;font-size:40px;shape-inside:url(#rect38);stroke-linecap:round;stroke-miterlimit:0;stroke-width:20;text-align:center">
                    <tspan x="361.37695" y="1179.0302" dominant-baseline="middle" text-anchor="middle"
                        data-text-content="url(#col2-value2)">2</tspan>
                </text>
                <text
                    style="fill:#ffffff;font-family:Arial;font-size:40px;shape-inside:url(#rect39);stroke-linecap:round;stroke-miterlimit:0;stroke-width:20;text-align:center">
                    <tspan x="361.37695" y="1229.0302" dominant-baseline="middle" text-anchor="middle"
                        data-text-content="url(#col2-value3)">3</tspan>
                </text>
            </g>
            <g>
                <text
                    style="fill:#ffffff;font-family:Arial;font-size:40px;shape-inside:url(#rect40);stroke-linecap:round;stroke-miterlimit:0;stroke-width:20;text-align:center">
                    <tspan x="573.87695" y="1129.0302" dominant-baseline="middle" text-anchor="middle"
                        data-text-content="url(#col3-value1)">1</tspan>
                </text>
                <text
                    style="fill:#ffffff;font-family:Arial;font-size:40px;shape-inside:url(#rect41);stroke-linecap:round;stroke-miterlimit:0;stroke-width:20;text-align:center">
                    <tspan x="573.87695" y="1179.0302" dominant-baseline="middle" text-anchor="middle"
                        data-text-content="url(#col3-value2)">2</tspan>
                </text>
                <text
                    style="fill:#ffffff;font-family:Arial;font-size:40px;shape-inside:url(#rect42);stroke-linecap:round;stroke-miterlimit:0;stroke-width:20;text-align:center">
                    <tspan x="573.87695" y="1229.0302" dominant-baseline="middle" text-anchor="middle"
                        data-text-content="url(#col3-value3)">3</tspan>
                </text>
            </g>
        </g>
        <g id="svg-card-button" style="cursor: pointer;" onmouseover="document.getElementById('svg-card-button-bg').setAttribute('fill', '#888888');" onmouseout="document.getElementById('svg-card-button-bg').setAttribute('fill','#999999');"> 
            <rect id="svg-card-button-bg" x="210" y="1288.5" width="300" height="75" ry="25"
                fill="#999999" style="stroke-linecap:round;stroke-miterlimit:0;stroke-width:1.9243"> </rect>
            <text
                style="fill:#ffffff;font-family:Arial;font-size:36px;shape-inside:url(#svgcard-datetime-rect);stroke-linecap:round;stroke-miterlimit:0;stroke-width:1.8;text-align:center-wrap">
                <tspan x="360" y="1330" dominant-baseline="middle" text-anchor="middle">ОТКРЫТЬ</tspan>
            </text>
        </g>
    </g>
    <script type="text/javascript">
        // <![CDATA[
        console.debug("[SVGCard] Svg script start")

        var mode_tag_2800_dict = {
            0: 'СТОП',
            1: 'АВТО',
            2: 'РУЧНОЙ',
            3: 'ТЕСТ+',
            4: 'ЗАПРЕТ',
            5: 'ПОЛЬЗ.',
            6: 'ТЕСТ-',
        }

        var alarm_tag_2880_dict = {
            0: 'ОТКЛ.',
            1: 'НОРМА',
            2: 'ВНИМАНИЕ',
            3: 'АВАРИЯ ДУ',
            4: 'АВАРИЯ ГЕН',
        }

        function lerp(a, b, t) 
        {
            return a + (b - a) * t
        }

        function clamp(min, max, value) 
        {
            if (value > max) {
                return max; 
            } 
            if (value < min) {
                return min; 
            } 
            return value; 
        }

        function change_arrow_position(percent)
        {
            console.debug("[SVGCard] Start rotating arrow")
            value = clamp(0, 100, percent) // If value more or less than 0-100 range than clamp it
            let arc_arrow = document.getElementById("svg-arc-arrow");
            let coord = arc_arrow.getBBox();
            let arrow_origin = (coord.x + (coord.width)) +' '+(coord.y + (coord.height)); // calculate origin point for rotation
            let arrow_angle = lerp(-90, 90, percent/100) // get angle by linear interpolation
            arc_arrow.setAttribute("transform", `rotate(${arrow_angle} ${arrow_origin})`)
            console.debug("[SVGCard] Arrow rotated")
        }

        function svg_button_listener(event){
            var objectLinkText = document.getElementById("svg-card-object-link-text").textContent;
            if (objectLinkText === ""){
                console.error("No object link in SvgCard parameters! Cannot redirect to object page")
                return;
            }
            var objectUrl = `https://dispatcher.farvater.group/#/Dashboard/cltwqj00n008col5pu2rb5mrc/play?variables=%7B%22assetId%22%3A%22${objectLinkText}%22%7D`
            window.open(objectUrl,'_blank');
        }
        
        var svgCardButton = document.getElementById("svg-card-button");
        svgCardButton.addEventListener("click", svg_button_listener);
        // add error catching for non number values
        var min_value = Number(document.getElementById("svg-card-ref-min-meter-text"));
        var max_value = Number(document.getElementById("svg-card-ref-max-meter-text"));

        var meterPercentValue = document.getElementById('meter-percent-text');
        var meterObserver = new MutationObserver((mutations) => 
        {
            console.debug("[SVGCard] Something mutate, start loop")
            mutations.forEach((mutation) => 
            {
                console.debug("[SVGCard] Current mutation type is " + mutation.type)
                // Search for mutation with childList type
                if (mutation.type === 'childList') { // childList mutation means text change in elemnent
                    let current_value = Number(mutation.target.textContent) // Parce from string value of current meter value                                       
                    let meter_percent = current_value / (max_value - min_value); 
                    change_arrow_position(meter_percent) // change arrow position
                }
            });
            console.debug("[SVGCard] Loop ended")
        });

        // Configure the observer to watch for changes to the text content
        meterObserver.observe(meterPercentValue, { characterData: true, subtree: true, childList: true });
        console.debug("[SVGCard] Svg script done")
        // Test observer function
        // setTimeout(() => {meterPercentValue.textContent = '80';}, 2000);
    // ]]>
    </script>

</svg>